# VASPilot

åŸºäºCrewAIæ™ºèƒ½ä»£ç†ç³»ç»Ÿçš„VASPè®¡ç®—è‡ªåŠ¨åŒ–å·¥å…·ï¼Œé›†æˆMCPï¼ˆModel Control Protocolï¼‰åè®®ï¼Œä¸ºææ–™ç§‘å­¦ç ”ç©¶æä¾›æ™ºèƒ½åŒ–çš„è®¡ç®—å·¥ä½œæµç¨‹ã€‚

## é¡¹ç›®ç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½ä»£ç†ç³»ç»Ÿ**: åŸºäºCrewAIæ¡†æ¶çš„å¤šæ™ºèƒ½ä½“åä½œï¼Œè‡ªåŠ¨åŒ–VASPè®¡ç®—æµç¨‹
- ğŸ”Œ **MCPåè®®æ”¯æŒ**: ç¬¦åˆModel Control Protocolæ ‡å‡†ï¼Œæä¾›æ ‡å‡†åŒ–çš„å·¥å…·æ¥å£
- ğŸ§® **å…¨é¢çš„VASPè®¡ç®—**: æ”¯æŒç»“æ„ä¼˜åŒ–ã€SCFã€NSCFã€èƒ½å¸¦è®¡ç®—ç­‰å¤šç§è®¡ç®—ç±»å‹
- ğŸ” **ææ–™æ•°æ®åº“é›†æˆ**: é›†æˆMaterials Project APIï¼Œä¾¿äºææ–™æœç´¢å’Œç»“æ„è·å–
- ğŸ“Š **å¯è§†åŒ–åˆ†æ**: å†…ç½®matplotlibç»˜å›¾å·¥å…·ï¼Œæ”¯æŒèƒ½å¸¦å›¾ã€æ€å¯†åº¦å›¾ç­‰åˆ†æ
- ğŸŒ **Webç•Œé¢**: æä¾›Flask WebæœåŠ¡å™¨ï¼Œæ”¯æŒæµè§ˆå™¨æ“ä½œ
- âš¡ **å¼‚æ­¥å¤„ç†**: æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—ä»»åŠ¡ç®¡ç†
- ğŸ“ **æ•°æ®åº“ç®¡ç†**: SQLiteæ•°æ®åº“å­˜å‚¨è®¡ç®—è®°å½•å’Œç»“æœ

## ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¯·æ±‚ â†’ CrewAIæ™ºèƒ½ä»£ç† â†’ MCPå·¥å…·æœåŠ¡ â†’ VASPè®¡ç®— â†’ ç»“æœåˆ†æ
    â†“              â†“              â†“            â†“           â†“
Webç•Œé¢        å¤šä»£ç†åä½œ      æ ‡å‡†åŒ–æ¥å£    HPCé›†ç¾¤     å¯è§†åŒ–å±•ç¤º
   â†“              â†“              â†“            â†“           â†“
FlaskæœåŠ¡      ä»»åŠ¡è§„åˆ’        å·¥å…·è°ƒç”¨      ä»»åŠ¡æäº¤     å›¾è¡¨ç”Ÿæˆ
```

## æ ¸å¿ƒç»„ä»¶

### 1. æ™ºèƒ½ä»£ç†ç³»ç»Ÿ
- **æ™¶ä½“ç»“æ„ä»£ç†**: è´Ÿè´£ç»“æ„æœç´¢ã€åˆ†æå’Œæ“ä½œ
- **VASPè®¡ç®—ä»£ç†**: æ‰§è¡Œå„ç§VASPè®¡ç®—ä»»åŠ¡
- **ç»“æœéªŒè¯ä»£ç†**: éªŒè¯å’Œåˆ†æè®¡ç®—ç»“æœ

### 2. MCPå·¥å…·æœåŠ¡
- **VASPè®¡ç®—å·¥å…·**: ç»“æ„ä¼˜åŒ–ã€SCFã€NSCFè®¡ç®—
- **ææ–™æœç´¢å·¥å…·**: Materials Projectæ•°æ®åº“é›†æˆ
- **ç»“æ„åˆ†æå·¥å…·**: æ™¶ä½“ç»“æ„åˆ†æå’Œå¯¹ç§°åŒ–
- **å¯è§†åŒ–å·¥å…·**: Pythonç»˜å›¾å’Œæ•°æ®åˆ†æ

### 3. WebæœåŠ¡å™¨
- **Flaskç•Œé¢**: ç”¨æˆ·å‹å¥½çš„Webæ“ä½œç•Œé¢
- **ä»»åŠ¡ç®¡ç†**: è®¡ç®—ä»»åŠ¡çš„æäº¤ã€ç›‘æ§å’Œç®¡ç†
- **ç»“æœå±•ç¤º**: è®¡ç®—ç»“æœçš„å¯è§†åŒ–å±•ç¤º

## å®‰è£…å’Œé…ç½®

### 1. å®‰è£…é¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°
git clone https://github.com/your-username/vaspilot.git
cd vaspilot

# å®‰è£…é¡¹ç›®ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
pip install -e .
```

### 2. é…ç½®æ–‡ä»¶

é¡¹ç›®æä¾›äº†ä¸¤ä¸ªä¸»è¦é…ç½®æ–‡ä»¶ï¼š

#### CrewAIé…ç½® (`configs/crew_config.yaml`)
é…ç½®æ™ºèƒ½ä»£ç†ç³»ç»Ÿã€LLMè¿æ¥å’ŒåµŒå…¥æ¨¡å‹ï¼š

```yaml
llm_mapper:
  deepseek-v3:
    base_url: http://your-llm-server:8000/v1
    api_key: your-api-key
    model: your-model-name
    temperature: 0

mcp_server:
  url: http://localhost:8933/mcp
  transport: streamable-http

agents:
  crystal_structure_agent:
    goal: "æ ¹æ®éœ€è¦ï¼Œåˆ©ç”¨å·¥å…·æœç´¢ã€åˆ†ææˆ–æ“ä½œæ™¶ä½“ç»“æ„"
    backstory: "ç»éªŒä¸°å¯Œçš„æ™¶ä½“ç»“æ„ä¸“å®¶"
```

#### MCPé…ç½® (`configs/mcp_config.yaml`)
é…ç½®VASPè®¡ç®—ç¯å¢ƒå’Œå‚æ•°ï¼š

```yaml
POTCAR_dir: /path/to/POTCARS/
VASP_cmd: srun -N 1 mpirun -np 64 vasp_ncl
work_dir: /path/to/work/directory
db_path: /path/to/database.db
mp_api_key: your-materials-project-api-key

VASP_default_INCAR:
  relaxation:
    PREC: 'Accurate'
    ISMEAR: 0
    SIGMA: 0.03
    EDIFF: 1e-6
    IBRION: 1
    EDIFFG: -0.005
    NSW: 100
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨MCPæœåŠ¡

```bash
# å¯åŠ¨MCPå·¥å…·æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£8933ï¼‰
vaspilot_mcp

# è‡ªå®šä¹‰é…ç½®å’Œç«¯å£
vaspilot_mcp --config configs/mcp_config.yaml --port 8933 --host 0.0.0.0
```

### 2. å¯åŠ¨CrewAIæœåŠ¡

```bash
# å¯åŠ¨CrewAI WebæœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£51293ï¼‰
vaspilot_server

# è‡ªå®šä¹‰é…ç½®å’Œç«¯å£
vaspilot_server --config configs/crew_config.yaml --port 51293 --host 0.0.0.0
```

### 3. Webç•Œé¢ä½¿ç”¨

è®¿é—® `http://localhost:51293` æ‰“å¼€Webç•Œé¢ï¼Œå¯ä»¥ï¼š
- æäº¤VASPè®¡ç®—ä»»åŠ¡
- ç›‘æ§è®¡ç®—è¿›åº¦
- æŸ¥çœ‹å’Œä¸‹è½½ç»“æœ
- å¯è§†åŒ–åˆ†ææ•°æ®

### 4. æ”¯æŒçš„è®¡ç®—ç±»å‹

#### ç»“æ„ä¼˜åŒ–
```python
# è‡ªåŠ¨ç»“æ„ä¼˜åŒ–
"å¯¹TiO2è¿›è¡Œç»“æ„ä¼˜åŒ–è®¡ç®—"
```

#### èƒ½å¸¦è®¡ç®—
```python
# SCF + NSCFèƒ½å¸¦è®¡ç®—
"è®¡ç®—MoS2çš„èƒ½å¸¦ç»“æ„"
```

#### ææ–™æœç´¢
```python
# Materials Projectæœç´¢
"æœç´¢å¸¦éš™åœ¨1-3eVä¹‹é—´çš„é’™é’›çŸ¿ææ–™"
```

## å‘½ä»¤è¡Œå‚æ•°

### vaspilot_mcp å‚æ•°
- `--config`: MCPé…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šconfigs/mcp_config.yamlï¼‰
- `--port`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ï¼š8933ï¼‰
- `--host`: æœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤ï¼š0.0.0.0ï¼‰
- `--work-dir`: å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ï¼šå½“å‰ç›®å½•ï¼‰
- `--debug`: å¼€å¯è°ƒè¯•æ¨¡å¼

### vaspilot_server å‚æ•°
- `--config`: CrewAIé…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šconfigs/crew_config.yamlï¼‰
- `--host`: æœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤ï¼š0.0.0.0ï¼‰
- `--port`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ï¼š51293ï¼‰
- `--work-dir`: å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ï¼šå½“å‰ç›®å½•ï¼‰
- `--allow-path`: å…è®¸è®¿é—®çš„ç›®å½•è·¯å¾„
- `--debug`: å¼€å¯è°ƒè¯•æ¨¡å¼

## å¼€å‘å’Œæ‰©å±•

### é¡¹ç›®ç»“æ„
```
src/vaspilot/
â”œâ”€â”€ scripts/          # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ server/           # WebæœåŠ¡å™¨
â”‚   â””â”€â”€ flask_server/ # Flaskå®ç°
â”œâ”€â”€ tools/            # å·¥å…·é›†åˆ
â”‚   â””â”€â”€ mcp/         # MCPå·¥å…·å®ç°
â”œâ”€â”€ crew/            # CrewAIä»£ç†å®šä¹‰
â””â”€â”€ listener/        # äº‹ä»¶ç›‘å¬å™¨
```

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `src/vaspilot/tools/mcp/` ä¸‹åˆ›å»ºæ–°çš„å·¥å…·æ¨¡å—
2. åœ¨MCPæœåŠ¡å™¨ä¸­æ³¨å†Œæ–°å·¥å…·
3. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„å·¥å…·åˆ—è¡¨

### è‡ªå®šä¹‰ä»£ç†

1. åœ¨ `configs/crew_config.yaml` ä¸­å®šä¹‰æ–°ä»£ç†
2. é…ç½®ä»£ç†çš„ç›®æ ‡ã€èƒŒæ™¯å’Œä½¿ç”¨çš„LLM
3. é‡å¯æœåŠ¡å™¨åº”ç”¨æ›´æ”¹

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MCPæœåŠ¡è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MCPæœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨
   - ç¡®è®¤ç«¯å£é…ç½®æ­£ç¡®
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. **VASPè®¡ç®—å¤±è´¥**
   - æ£€æŸ¥POTCARè·¯å¾„é…ç½®
   - ç¡®è®¤VASPå‘½ä»¤å¯æ‰§è¡Œ
   - æ£€æŸ¥HPCç¯å¢ƒè®¾ç½®

3. **LLMè¿æ¥é—®é¢˜**
   - éªŒè¯APIå¯†é’¥å’Œç«¯ç‚¹URL
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤æ¨¡å‹åç§°æ­£ç¡®

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `--debug` å‚æ•°å¯åŠ¨æœåŠ¡å™¨
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥æ•°æ®åº“ä¸­çš„ä»»åŠ¡çŠ¶æ€
4. éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼

## ä¾èµ–é¡¹

ä¸»è¦ä¾èµ–åŒ…ï¼š
- `crewai>=0.102.0` - æ™ºèƒ½ä»£ç†æ¡†æ¶
- `fastmcp>=2.10.6` - MCPåè®®å®ç°
- `pymatgen>=2025.0.0` - ææ–™ç§‘å­¦å·¥å…·
- `ase>=3.22.0` - åŸå­ç»“æ„ç¯å¢ƒ
- `flask` - Webæ¡†æ¶
- `numpy`, `pandas`, `matplotlib` - æ•°æ®åˆ†æå’Œå¯è§†åŒ–

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## è‡´è°¢

- [CrewAI](https://github.com/joaomdmoura/crewAI) - æ™ºèƒ½ä»£ç†æ¡†æ¶
- [Pymatgen](https://pymatgen.org/) - ææ–™ç§‘å­¦è®¡ç®—å·¥å…·
- [Materials Project](https://materialsproject.org/) - ææ–™æ•°æ®åº“ 